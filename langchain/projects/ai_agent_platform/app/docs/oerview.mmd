graph TD

%% CLIENT
    subgraph Client [User Interface]
        StreamlitUI["ğŸ§‘â€ğŸ’» Streamlit UI"]
    end

%% API
    subgraph API [Backend API]
        FastAPI["ğŸš€ FastAPI (Receives Request)"]
        BackgroundTask["â³ Background Task (Async Processing)"]
    end

%% AGENT
    subgraph LangGraphAgent [AI Orchestration]
        LangGraphAgentCore["ğŸ§  LangGraph Agent"]
        Planner["ğŸ“ Planner Node"]
        ToolExecutor["ğŸ› ï¸ Tool Executor Node"]
    end

%% TOOLS
    subgraph Tools [Dynamic Async Tools]
        ToolRegistry["ğŸ“¦ Tool Registry"]
        ToolRunner["ğŸ”§ @tool Decorated Tools"]
    end

%% LLM
    subgraph LLMProvider [LLM Backend]
        LLMSelector["ğŸ›ï¸ Provider Selector (settings.py)"]
        OpenAI["ğŸ¤– OpenAI"]
        Ollama["ğŸ¦™ Ollama (default)"]
        DummyLLM["ğŸ§¹ Dummy LLM"]
    end

%% LOGGING
    subgraph Logs [Logs & History]
        MarkdownLogger["ğŸ“ Markdown Logger (logs/*.md)"]
        PersistentDB["ğŸ“š Persistent History DB (future)"]
    end

%% === Flow Arrows ===

    StreamlitUI -->|Submit Request| FastAPI
    FastAPI -->|Create Task| BackgroundTask
    BackgroundTask -->|Run Agent| LangGraphAgentCore

    LangGraphAgentCore --> Planner
    Planner -->|Decide Tool| ToolExecutor
    ToolExecutor -->|Fetch tool| ToolRegistry
    ToolRegistry --> ToolRunner
    ToolRunner -->|Run Async Tool| ToolExecutor

    LangGraphAgentCore -->|Use LLM| LLMSelector
    LLMSelector --> OpenAI
    LLMSelector --> Ollama
    LLMSelector --> DummyLLM

    ToolExecutor -->|Tool Result| MarkdownLogger
    ToolExecutor --> BackgroundTask
    BackgroundTask -->|Task Done| FastAPI
    FastAPI -->|Return to User| StreamlitUI

    FastAPI --> PersistentDB
    StreamlitUI --> PersistentDB
    BackgroundTask --> PersistentDB